FILE: src/utils/urls.ts
// Helper function to get the base URL of the app
// Useful for future SSR or production deployments
export function getBaseUrl() {
  if (typeof window !== 'undefined') return ''; // browser should use relative url
  if (process.env.VERCEL_URL) return `https://${process.env.VERCEL_URL}`; // SSR should use vercel url
  return `http://localhost:${process.env.PORT ?? 3000}`; // dev SSR should use localhost
}-e 
---

FILE: src/utils/trpc-provider.tsx
'use client';

import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { httpBatchLink } from '@trpc/client';
import React, { useState } from 'react';
import { trpc } from './trpc';

export function TRPCProvider({ children }: { children: React.ReactNode }) {
  // 1. Create a Query Client (React Query)
  const [queryClient] = useState(() => new QueryClient());
  
  // 2. Create a tRPC Client with the correct links
  const [trpcClient] = useState(() =>
    trpc.createClient({
      links: [
        httpBatchLink({
          url: '/api/trpc',
        }),
      ],
    })
  );

  return (
    <trpc.Provider client={trpcClient} queryClient={queryClient}>
      <QueryClientProvider client={queryClient}>
        {children}
      </QueryClientProvider>
    </trpc.Provider>
  );
}-e 
---

FILE: src/utils/trpc.ts
import { createTRPCReact } from '@trpc/react-query';
import type { AppRouter } from '@/server/routers/_app';

// Create the tRPC hooks for the client
export const trpc = createTRPCReact<AppRouter>();-e 
---

FILE: src/app/page.tsx
'use client';

import { trpc } from '@/utils/trpc';

export default function Home() {
  // We call our "getProducts" procedure
  const productsQuery = trpc.products.getProducts.useQuery();

  if (productsQuery.isLoading) return <p>Loading products...</p>;
  if (productsQuery.error) return <p>Error: {productsQuery.error.message}</p>;

  return (
    <main style={{ padding: '2rem' }}>
      <h1>Product Dashboard</h1>
      <div style={{ display: 'grid', gap: '1rem' }}>
        {productsQuery.data?.map((product: any) => (
          <div key={product.id} style={{ border: '1px solid #ccc', padding: '1rem', borderRadius: '8px' }}>
            <h2>{product.name}</h2>
            <p>{product.description}</p>
            <p><strong>Price:</strong> ${product.price}</p>
            <p><strong>In Stock:</strong> {product.stock}</p>
          </div>
        ))}
      </div>
    </main>
  );
}-e 
---

FILE: src/app/api/trpc/[trpc]/route.ts
import { fetchRequestHandler } from '@trpc/server/adapters/fetch';
import { appRouter } from '@/server/routers/_app';

// The handler for tRPC requests in Next.js App Router
const handler = (req: Request) =>
  fetchRequestHandler({
    endpoint: '/api/trpc',
    req,
    router: appRouter,
    createContext: () => ({}),
  });

export { handler as GET, handler as POST };-e 
---

FILE: src/app/layout.tsx
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";
import { TRPCProvider } from '@/utils/trpc-provider';

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        <TRPCProvider>
        {children}
        </TRPCProvider>
      </body>
    </html>
  );
}
-e 
---

FILE: src/server/schema.ts
// ... existing code ...
import { z } from "zod";

export const ProductSchema = z.object({
  id: z.string(),
  name: z.string().min(2, "Name is too short"),
  description: z.string(),
  price: z.number().positive("Price must be greater than 0"),
  category: z.string(),
  stock: z.number().int().nonnegative(),
  image: z.string().optional(),
});

export type Product = z.infer<typeof ProductSchema>;-e 
---

FILE: src/server/trpc.ts
import { initTRPC } from '@trpc/server';

// Initialize tRPC
const t = initTRPC.create();

// Export tools for creating routers and procedures
export const router = t.router;
export const publicProcedure = t.procedure;-e 
---

FILE: src/server/routers/_app.ts
import { router } from '../trpc';
import { productsRouter } from './products';

// This is the main router that combines all other routers
export const appRouter = router({
  products: productsRouter,
});

// Export the type of the router for the frontend
export type AppRouter = typeof appRouter;-e 
---

FILE: src/server/routers/products.ts
import { router, publicProcedure } from '../trpc';
import { ProductSchema } from '../schema';
import fs from 'fs/promises';
import path from 'path';

export const productsRouter = router({
  // This is a procedure to get all products
  getProducts: publicProcedure
    .query(async () => {
      // Path to our JSON file
      const filePath = path.join(process.cwd(), 'data', 'products.json');
      
      // Reading the file
      const jsonData = await fs.readFile(filePath, 'utf-8');
      
      // Parsing the JSON data
      const products = JSON.parse(jsonData);
      
      return products as any[]; 
    }),
});-e 
---

